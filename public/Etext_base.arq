#QueryScope=Etexts
#QueryReturnType=Graph
#QueryResults=Basic Info about an etext
#QueryParams=R_RES
#QueryUrl=/Etext_base?R_RES=bdr:UT4CZ5369_I1KG9127_0000

#param.R_RES.type=URI
#param.R_RES.subtype=bdo:Etext
#param.R_RES.desc=the etext on which info is needed

PREFIX tmp: <http://purl.bdrc.io/ontology/tmp/>

construct { 
   ?R_RES ?p ?o .
   ?ie ?iep ?ieo .
   ?ev ?evp ?evo .
   ?mw skos:prefLabel ?mwpl .
   ?mwroot skos:prefLabel ?mwrootpl .
   ?R_RES tmp:etextIsPaginated ?eip .
   ?R_RES tmp:hasEtextVolume ?vl .
  }
where {
  { 
    ?R_RES ?p ?o .
    BIND (?R_RES as ?s)
  } union {
    ?R_RES bdo:eTextInInstance  ?ie .
    ?ie ?iep ?ieo .
  } union {
    ?R_RES :eTextForInstance ?mw .
    ?mw skos:prefLabel ?mwpl .
  } union {
    ?R_RES :eTextInInstance ?ie .
    ?ie :instanceReproductionOf ?mwroot .
    FILTER(not exists {?mwroot a :ImageInstance})
    ?mwroot skos:prefLabel ?mwrootpl .
  } union {
    # get image volume ID
    ?R_RES :eTextInVolume ?ev .
    ?ev ?evp ?evo .
  } union {
    BIND(exists {?R_RES :eTextInInstance ?ie . ?ie :instanceReproductionOf ?w . ?w a :ImageInstance } as ?eip)
  } union {
    # add
    ?vl :eTextVolumeForImageGroup ?R_RES . 
  }
} 
